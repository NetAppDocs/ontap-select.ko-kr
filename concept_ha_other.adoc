---
sidebar: sidebar 
permalink: concept_ha_other.html 
keywords: ontap select, ha, high availability, disk heartbeating, heartbeating, mailbox, failover, giveback 
summary: HA 디스크 하트비팅, HA 메일박스, HA 하트비팅, HA 페일오버 및 기브백은 데이터 보호를 강화합니다. 
---
= ONTAP Select HA는 데이터 보호를 향상시킵니다
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
고가용성(HA) 디스크 하트비팅, HA 메일박스, HA 하트비팅, HA 페일오버 및 기브백 작업으로 데이터 보호 강화



== 디스크 하트비팅

ONTAP Select HA 아키텍처에서 기존 FAS 어레이에서 사용되는 여러 코드 경로를 활용하기는 하지만, 몇 가지 예외가 있습니다. 이러한 예외 중 하나는 네트워크 격리가 브레인 분할 동작을 일으키는 것을 방지하기 위해 클러스터 노드에서 사용하는 비네트워크 기반 통신 방법인 디스크 기반 하트비팅을 구현하는 것입니다. 브레인 분할 시나리오는 클러스터 분할의 결과로서, 일반적으로 네트워크 장애로 인해 발생하며, 각 측에서는 다른 쪽이 다운되어 클러스터 리소스를 인수하려고 한다고 믿고 있습니다.

엔터프라이즈급 HA 구현에서는 이러한 유형의 시나리오를 적절하게 처리해야 합니다. ONTAP는 사용자 지정된 디스크 기반 하트비팅 방법을 통해 이 작업을 수행합니다. 이 작업은 클러스터 노드에서 하트비트 메시지를 전달하는 데 사용되는 물리적 스토리지의 위치인 HA 사서함의 작업입니다. 이렇게 하면 클러스터에서 연결을 확인할 수 있으므로 장애 조치 시 쿼럼을 정의할 수 있습니다.

공유 스토리지 HA 아키텍처를 사용하는 FAS 어레이에서 ONTAP는 다음과 같은 방법으로 브레인 분할 문제를 해결합니다.

* SCSI 영구 예약
* 영구적 HA 메타데이터
* HA 인터커넥트를 통해 전송된 HA 상태입니다


하지만 ONTAP Select 클러스터의 무공유 아키텍처에서 노드는 HA 파트너의 자체 로컬 스토리지만 볼 수 있습니다. 따라서 네트워크 파티셔닝으로 HA 쌍의 각 측면이 격리되면 앞에서 설명한 클러스터 쿼럼 및 페일오버 동작 결정 방법을 사용할 수 없습니다.

기존의 브레인 분할 탐지 및 회피 방법은 사용할 수 없지만, 비공유 환경의 제약 조건에 맞는 중재 방법이 여전히 필요합니다. ONTAP Select는 기존 메일박스 인프라를 더욱 확장하여 네트워크 파티션 분할 시 IT가 조정 방법으로 사용할 수 있도록 합니다. 공유 스토리지를 사용할 수 없기 때문에 중재는 NAS를 통해 메일박스 디스크에 대한 액세스를 통해 수행됩니다. 이러한 디스크는 iSCSI 프로토콜을 사용하여 2노드 클러스터의 중재자를 포함하여 클러스터 전체에 분산됩니다. 따라서 이러한 디스크에 대한 액세스를 기반으로 클러스터 노드에서 지능적으로 페일오버를 결정할 수 있습니다. 노드가 HA 파트너 외부의 다른 노드의 메일박스 디스크에 액세스할 수 있는 경우 정상 상태가 될 수 있습니다.


NOTE: ONTAP Select의 다중 노드 변형에는 4개의 개별 노드 또는 2노드 클러스터의 중재자가 필요한 이유는 사서함 아키텍처 및 클러스터 쿼럼과 브레인 분할 문제를 해결하기 위한 디스크 기반 하트비팅 방법입니다.



== HA 사서함 게시

HA 사서함 아키텍처는 메시지 게시 모델을 사용합니다. 클러스터 노드는 반복 간격으로 중재자를 포함하여 클러스터의 다른 모든 메일박스 디스크에 노드가 실행 중임을 나타내는 메시지를 게시합니다. 특정 시점의 정상적인 클러스터 내에서 클러스터 노드의 단일 메일박스 디스크에는 다른 모든 클러스터 노드에서 보낸 메시지가 표시됩니다.

각 Select 클러스터 노드에 연결된 가상 디스크는 공유 메일박스 액세스에 주로 사용됩니다. 이 디스크는 노드 장애 또는 네트워크 파티션 분할 시 클러스터 중재 방법으로 기능하기 때문에 중재자 메일박스 디스크라고 합니다. 이 메일박스 디스크는 각 클러스터 노드의 파티션을 포함하며 다른 Select 클러스터 노드에 의해 iSCSI 네트워크를 통해 마운트됩니다. 주기적으로 이러한 노드는 메일박스 디스크의 적절한 파티션에 상태 상태를 게시합니다. 클러스터 전반에 걸쳐 네트워크 액세스 가능 메일박스 디스크를 사용하면 성능 매트릭스를 통해 노드 상태를 추론할 수 있습니다. 예를 들어 클러스터 노드 A와 B는 클러스터 노드 D의 메일박스에 게시할 수 있지만 노드 C의 메일박스에는 게시할 수 없습니다 또한 클러스터 노드 D는 노드 C의 사서함에 게시할 수 없으므로 노드 C가 다운되었거나 네트워크가 격리되어 작업을 수행해야 할 수 있습니다.



== 하쓰비팅

NetApp FAS 플랫폼과 마찬가지로 ONTAP Select은 HA 인터커넥트를 통해 HA 하트비트 메시지를 주기적으로 전송합니다. ONTAP Select 클러스터 내에서 HA 파트너 간에 존재하는 TCP/IP 네트워크 연결을 통해 수행됩니다. 또한 디스크 기반 하트비트 메시지는 중재자 메일박스 디스크를 포함하여 모든 HA 메일박스 디스크에 전달됩니다. 이러한 메시지는 몇 초마다 전달되고 주기적으로 다시 읽힙니다. 이러한 이벤트가 전송 및 수신되는 빈도에 따라 ONTAP Select 클러스터는 FAS 플랫폼에서 사용 가능한 동일한 창에서 약 15초 내에 HA 장애 이벤트를 감지할 수 있습니다. 하트비트 메시지를 더 이상 읽지 않으면 페일오버 이벤트가 트리거됩니다.

다음 그림은 단일 ONTAP Select 클러스터 노드 C의 관점에서 HA 인터커넥트와 디스크 중재자를 통해 하트비트 메시지를 보내고 받는 프로세스를 보여 줍니다


NOTE: 네트워크 하트비트는 HA 인터커넥트를 통해 HA 파트너, 노드 D로 전송되고 디스크 하트비트는 모든 클러스터 노드, A, B, C, D에 메일박스 디스크를 사용합니다

* 4노드 클러스터의 HA 하트비팅: 안정적 상태 *image:DDHA_05.jpg["4노드 클러스터의 HA 하트비팅: 안정적 상태"]



== HA 페일오버 및 반환

장애 조치 작업 중에 정상적인 노드는 HA 파트너 데이터의 로컬 복사본을 사용하여 피어 노드에 대한 데이터 서비스 책임을 맡습니다. 클라이언트 I/O는 중단되지 않고 계속 작동할 수 있지만 이 데이터에 대한 변경 사항은 반환이 수행되기 전에 다시 복제되어야 합니다. ONTAP Select는 강제 반환을 지원하지 않습니다. 활성 노드에 저장된 변경 사항이 손실되기 때문입니다.

재부팅 노드가 클러스터에 다시 연결되면 다시 동기화 작업이 자동으로 트리거됩니다. 동기화 재동기화에 필요한 시간은 여러 요인에 따라 달라집니다. 이러한 요소에는 복제해야 하는 변경 사항 수, 노드 간 네트워크 지연 시간, 각 노드의 디스크 서브시스템 속도가 포함됩니다. 다시 동기화에 필요한 시간이 자동 줄넘기는 시간(자동 줄넘기는 시간)이 10분을 초과할 수 있습니다. 이 경우 다시 동기화 후 수동 반환이 필요합니다. 다음 명령을 사용하여 다시 동기화의 진행률을 모니터링할 수 있습니다.

[listing]
----
storage aggregate status -r -aggregate <aggregate name>
----