---
sidebar: sidebar 
permalink: concept_ha_mirroring.html 
keywords: ontap select, ha, high availability, synchronous replication, mirrored aggregates, write path, raid syncmirror, rsm 
summary: 'RAID RSM(SyncMirror), 미러링된 애그리게이트 및 쓰기 경로를 사용하여 데이터 손실을 방지합니다.' 
---
= HA RSM 및 미러링된 애그리게이트
:hardbreaks:
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
RAID RSM(SyncMirror), 미러링된 애그리게이트 및 쓰기 경로를 사용하여 데이터 손실을 방지합니다.



== 동기식 복제

ONTAP HA 모델은 HA 파트너의 개념을 기반으로 합니다. ONTAP Select는 ONTAP에 있는 RAID RSM(SyncMirror) 기능을 사용하여 클러스터 노드 간에 데이터 블록을 복제하여 HA 쌍 전체에 사용자 데이터의 복사본 2개를 제공함으로써 이러한 아키텍처를 비공유 일반 서버 환경으로 확장합니다.

중재자가 있는 2노드 클러스터는 두 데이터 센터에 걸쳐 있을 수 있습니다. 자세한 내용은 섹션을 참조하십시오 link:reference_plan_best_practices.html#two-node-stretched-ha-metrocluster-sds-best-practices["2노드 확장 HA(MetroCluster SDS) 모범 사례"].



== 미러링된 애그리게이트

ONTAP Select 클러스터는 2~8개의 노드로 구성됩니다. 각 HA 쌍에는 사용자 데이터의 복사본 2개가 포함되어 있으며 IP 네트워크를 통해 노드 간에 동기식으로 미러링됩니다. 이 미러링은 사용자에게 투명하며, 데이터 애그리게이트 생성 프로세스 중에 자동으로 구성되는 데이터 애그리게이트의 속성입니다.

ONTAP Select 클러스터의 모든 애그리게이트는 노드 페일오버 시 데이터 가용성을 위해 미러링되어야 하고 하드웨어 장애 발생 시 SPOF를 피해야 합니다. ONTAP Select 클러스터의 Aggregate는 HA 쌍의 각 노드에서 제공하는 가상 디스크를 기반으로 하며 다음 디스크를 사용합니다.

* 로컬 디스크 세트(현재 ONTAP Select 노드에서 제공)
* 미러링된 디스크 세트(현재 노드의 HA 파트너가 제공)



NOTE: 미러링된 Aggregate를 구축하는 데 사용되는 로컬 및 미러 디스크의 크기는 동일해야 합니다. 이러한 애그리게이트를 플렉스 0 및 플렉스 1이라고 합니다(각각 로컬 및 원격 미러 쌍 표시). 실제 plex 번호는 설치 시 다를 수 있습니다.

이 접근 방식은 표준 ONTAP 클러스터의 작동 방식과 근본적으로 다릅니다. 이는 ONTAP Select 클러스터 내의 모든 루트 및 데이터 디스크에 적용됩니다. Aggregate는 데이터의 로컬 복사본과 미러 복사본을 모두 포함합니다. 따라서 N 가상 디스크를 포함하는 집계는 데이터의 두 번째 사본이 고유한 디스크에 상주하므로 N/2 디스크의 고유 스토리지 가치를 제공합니다.

다음 그림에서는 4노드 ONTAP Select 클러스터 내의 HA 쌍을 보여 줍니다. 이 클러스터 내에는 두 HA 파트너의 스토리지를 사용하는 단일 애그리게이트(테스트)가 있습니다. 이 데이터 집계는 2개의 가상 디스크 세트로 구성되어 있습니다. 하나는 ONTAP Select 소유 클러스터 노드(Plex 0)에서 제공하는 로컬 세트와 대체 작동 파트너(Plex 1)가 제공하는 원격 세트입니다.

Plex 0은 모든 로컬 디스크를 보관하는 버킷입니다. Plex 1은 미러 디스크를 보관하는 버켓 또는 사용자 데이터의 두 번째 복제 사본을 저장하는 역할을 하는 디스크입니다. Aggregate를 소유하는 노드는 디스크를 Plex 0에 제공하고 해당 노드의 HA 파트너가 디스크를 Plex 1에 제공합니다.

다음 그림에서는 두 개의 디스크가 있는 미러링된 Aggregate가 있습니다. 이 집계의 내용은 2개의 클러스터 노드에 걸쳐 미러링되며, 로컬 디스크 net-1.1은 Plex 0 버킷에, 원격 디스크 net-2.1은 Plex 1 버킷에 배치됩니다. 이 예제에서 애그리게이트 테스트는 클러스터 노드 왼쪽의 소유이며 로컬 디스크 net-1.1 및 HA 파트너 미러 디스크 net-2.1을 사용합니다.

* ONTAP Select 미러링된 애그리게이트 *image:DDHA_03.jpg["ONTAP Select 미러링된 애그리게이트"]


NOTE: ONTAP Select 클러스터가 구축되면 시스템에 있는 모든 가상 디스크가 올바른 플렉스(plex)에 자동으로 할당되므로 디스크 할당과 관련하여 사용자에게 추가 단계가 필요하지 않습니다. 이렇게 하면 실수로 디스크를 잘못된 플렉스에 할당하지 않고 최적의 미러 디스크 구성을 제공할 수 있습니다.



== 쓰기 경로

클러스터 노드 간 데이터 블록의 동기식 미러링과 시스템 장애 시 데이터 손실이 없어야 합니다. 쓰기 작업이 ONTAP Select 클러스터를 통해 전파될 때 발생하는 경로에 큰 영향을 미칩니다. 이 프로세스는 다음 두 단계로 구성됩니다.

* 승인
* 디스테이징


타겟 볼륨에 대한 쓰기는 데이터 LIF에서 수행되고 가상화된 NVRAM 파티션에 커밋된 다음, ONTAP Select 노드의 시스템 디스크에 저장된 후 클라이언트로 다시 인식됩니다. HA 구성에서 이러한 NVRAM 쓰기는 인식되기 전에 타겟 볼륨 소유자의 HA 파트너에게 즉시 미러링되므로 추가 단계가 발생합니다. 이 프로세스에서는 원래 노드에 하드웨어 장애가 발생한 경우 HA 파트너 노드의 파일 시스템 정합성을 보장합니다.

NVRAM에 쓰기가 커밋된 후 ONTAP는 이 파티션의 내용을 적절한 가상 디스크로 정기적으로 이동합니다. 이 프로세스는 디스테이징이라고 합니다. 이 프로세스는 타겟 볼륨을 소유하는 클러스터 노드에서 한 번만 수행되며 HA 파트너에서 실행되지 않습니다.

다음 그림에서는 ONTAP Select 노드에 대한 수신 쓰기 요청의 쓰기 경로를 보여 줍니다.

* ONTAP Select 쓰기 경로 워크플로우 *image:DDHA_04.jpg["ONTAP Select 쓰기 경로 워크플로우"]

들어오는 쓰기 승인에는 다음 단계가 포함됩니다.

* 쓰기 작업은 ONTAP Select 노드 A가 소유하는 논리 인터페이스를 통해 시스템으로 들어갑니다
* 쓰기는 노드 A의 NVRAM에 커밋되고 HA 파트너인 노드 B에 미러링됩니다
* 두 HA 노드에 I/O 요청이 있으면 해당 요청이 클라이언트에 다시 전달됩니다.


ONTAP Select는 NVRAM에서 데이터 애그리게이트(ONTAP CP)로 디스테이징하는 단계는 다음과 같습니다.

* 쓰기는 가상 NVRAM에서 가상 데이터 애그리게이트로 디스테이징됩니다.
* 미러 엔진은 두 플렉스에 블록을 동기식으로 복제합니다.

